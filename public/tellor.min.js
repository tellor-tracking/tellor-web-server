this.window=this.window||{},this.window.Tellor=function(){"use strict";var t=function(t){return void 0!==t.name},e=function(t){return"events=["+JSON.stringify(t)+"]"},r=function(r){if(t(r)){var n=void 0;try{n=e(r)}catch(t){return}return n}},n={event:r},o=(function(){function t(t){this.value=t}function e(e){function r(t,e){return new Promise(function(r,o){var s={key:t,arg:e,resolve:r,reject:o,next:null};a?a=a.next=s:(i=a=s,n(t,e))})}function n(r,i){try{var a=e[r](i),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(a.done?"return":"normal",a.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?n(i.key,i.arg):a=null}var i,a;this._invoke=r,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=function(){function t(e,r){o(this,t),this.tellor=e,this.runInterval=r?500:1e4,this.apiEndPoint="/track",this.standardParams=this._formatStandardParams(),setInterval(this.run.bind(this),this.runInterval)}return i(t,[{key:"run",value:function(){var t=this.tellor.store.get();t.forEach(this._XHRGet.bind(this))}},{key:"_XHRGet",value:function(t){var e=this.tellor.store;e.lockItem(t);try{var r=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",""+this.tellor.url+this.apiEndPoint+"?"+this.standardParams+"&"+t.params,!0),r.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<300?e.remove(t):4===this.readyState&&(e.unlockItem(t),console.error("Failed to track",t))},r.send()}catch(r){e.remove(t)}}},{key:"_formatStandardParams",value:function(){var t=this.tellor,e="sdk="+t.sdk+"&app_key="+t.appKey+"&app_version="+t.appVersion;return t.user&&t.user.id&&(e+="userId="+t.user.id),t.user&&t.user.id&&t.user.name&&(e+="userId="+t.user.name),e}}]),t}(),s=function(){function t(e){o(this,t),this.transport=e,this._LSId="__ttc__",this.q=this._getLocalStorageCache()}return i(t,[{key:"submit",value:function(t){var e=this._create(t);this._addToLocalStorage(e),this.q.push(e),this.transport.run()}},{key:"get",value:function(){return this.q.filter(function(t){return!t.isLocked})}},{key:"remove",value:function(t){var e=this.q.indexOf(t);e>-1&&this.q.splice(e,1),this._removeFromLocalStorage(t)}},{key:"lockItem",value:function(t){t.isLocked=!0}},{key:"unlockItem",value:function(t){t.isLocked=!1}},{key:"_create",value:function(t){return{params:t,id:Date.now()+Math.random().toFixed()}}},{key:"_getLocalStorageCache",value:function(){try{return JSON.parse(localStorage.getItem(this._LSId))||[]}catch(t){return[]}}},{key:"_addToLocalStorage",value:function(t){var e=this._getLocalStorageCache();e.push(t),localStorage.setItem(this._LSId,JSON.stringify(e))}},{key:"_removeFromLocalStorage",value:function(t){var e=this._getLocalStorageCache(),r=e.filter(function(e){return e.id!=t.id});localStorage.setItem(this._LSId,JSON.stringify(r))}}]),t}(),u=function(){function t(e,r,n,i){var a=i.appKey,s=i.appVersion,u=void 0===s?"1":s,c=i.url,h=i.user,l=i.debug,f=void 0!==l&&l;o(this,t),this.sdk="web",this.appKey=a,this.appVersion=u,this.url=c,this.user=h,this.formatters=e,this.transport=new r(this,f),this.store=new n(this.transport,f),void 0!==window.__ttq&&window.__ttq.forEach(this.track.bind(this))}return i(t,[{key:"track",value:function(t){var e=this.formatters.event(t);e&&this.store.submit(e)}}]),t}(),c={init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.appKey&&t.url?void(window.Tellor=new u(n,a,s,t)):console.warn("You must provide app_key and url")}};return c}();